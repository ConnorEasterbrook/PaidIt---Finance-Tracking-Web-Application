"use strict";function _toConsumableArray(n){if(Array.isArray(n)){for(var t=0,i=Array(n.length);t<n.length;t++)i[t]=n[t];return i}return Array.from(n)}function InitializeChart(n){var f=[],r,u,i,e,o,s,h,t,c,l;for(t in n.Accounts)if(n.Accounts[t].Inputs.length!==0){for(r=n.Accounts[t].Inputs,u=[],i=0;i<r.length;i++)e=new Date(r[i].Date),o=r[i].Amount,u.push({x:e,y:o});s={label:t,data:u,backgroundColor:n.Accounts[t].Colour,fill:!0};f.push(s)}chart=new Chart(document.getElementById("myChart"),{type:"line",data:{labels:[],datasets:f},options:{responsive:!0,plugins:{tooltip:{mode:"index"},legend:{labels:{font:{size:20}}}},interaction:{mode:"nearest",axis:"x",intersect:!1},scales:{x:{title:{display:!0,text:"Month",font:{size:20}},ticks:{font:{size:20},color:"rgb(209, 209, 209)"}},y:{beginAtZero:!0,stacked:!0,title:{display:!0,text:"Total Money",font:{size:20}},ticks:{callback:function(n){return"£"+n},font:{size:20},color:"rgb(209, 209, 209)"}}}}});h=$("#accountsContainer");for(t in n.Accounts)c={name:t,label:t,data:n.Accounts[t].Inputs,borderColor:"#ffffff",backgroundColor:n.Accounts[t].Colour,fill:!0},l=CreateAccountButton(c),h.append(l);UpdateData()}function AddAccount(){var n,t;if(console.log("AddAccount"),n=prompt("Enter the name of the account:"),n){if(accounts[n]){alert("An account with that name already exists.");return}t={name:n,label:n,backgroundColor:"#ffffff",data:[],borderColor:"#6b6b6b",fill:!0};chart.data.datasets.push(t);chart.update();accounts[n]={Inputs:[]};$("#accountsContainer").append(CreateAccountButton(t));$.ajax({url:"/Home/AddNewAccountAjax",type:"POST",data:{accountName:n},success:function(){alert("Success")},error:function(){alert("An error occurred while calling the C# function.")}})}}function CreateAccountButton(n){var t=$("<span>",{id:"account_button-"+n.name,"class":"account_button",text:n.name,css:{backgroundColor:n.backgroundColor}});return t.addClass("secondary_button").addClass("secondary_button--selectable"),t}function UpdateData(){var n=arguments.length<=0||arguments[0]===undefined?0:arguments[0],t,i;previousMonth!==n&&(previousMonth=n,t=new Date(Math.min.apply(Math,_toConsumableArray(chart.data.datasets.flatMap(function(n){return n.data.map(function(n){return new Date(n.x).getTime()})})))),i=new Date(Math.max.apply(Math,_toConsumableArray(chart.data.datasets.flatMap(function(n){return n.data.map(function(n){return new Date(n.x).getTime()})})))),chart.data.labels=GetMonthLabels(t,i),chart.data.datasets.forEach(function(n){var t=[];chart.data.labels.forEach(function(i){var r=n.data.find(function(n){return new Date(n.x).toLocaleString("default",{month:"long",year:"numeric"})===i}),u=new Date(i),f=r?r.y:t.length>0?t[t.length-1].y:0;t.push({x:u,y:f})});n.data=t}),chart.update())}function GetMonthLabels(n,t){for(var r=[],i=n;i<=t;i.setMonth(i.getMonth()+1))r.push(i.toLocaleString("default",{month:"long",year:"numeric"}));return r}var chart,accounts=[],previousMonth=1;window.onload=function(){var n=$("#accountsContainer").data("chart");InitializeChart(n)};$("#accountsContainer").on("click",".account_button",function(){var i=$(this).index(),n=chart.data.datasets[i],t=chart.getDatasetMeta(i),r=t.hidden===null?n.hidden:t.hidden;n.hidden=!r;t.hidden=!r;n.hidden?$(this).css("opacity","0.2"):$(this).css("opacity","1");chart.update()});$("#addAccountBtn").on("click",AddAccount);